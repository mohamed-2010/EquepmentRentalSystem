# ๐ ููุฎุต ุงูุชุนุฏููุงุช ุงูููุชููุฉ

## โ ุชู ุฅูุฌุงุฒู ุจูุฌุงุญ:

### 1. ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ูู ุฌุฏูู ุงูุนููุงุก โ

**ุงููููุงุช ุงููุนุฏูุฉ:**

- `supabase/migrations/20251029160000_add_customer_fields_and_branch_accounts.sql`
- `src/lib/offline/db.ts` - ุชุญุฏูุซ `CustomerData` interface
- `src/pages/Customers.tsx` - ุฅุถุงูุฉ ุญููู "ูุตุฏุฑ ุงููููุฉ" ู "ุงูุนููุงู"
- `src/components/CustomerAutocomplete.tsx` - ุชุญุฏูุซ ูููุฐุฌ ุงูุฅุถุงูุฉ

**ุงููุชูุฌุฉ:**

```typescript
interface CustomerData {
  // ... ุงูุญููู ุงูุณุงุจูุฉ
  id_source?: string; // โ ุฌุฏูุฏ: ูุตุฏุฑ ุงููููุฉ (ุงูุฑูุงุถุ ุฌุฏุฉุ ุฅูุฎ)
  address?: string; // โ ุฌุฏูุฏ: ุนููุงู ุงูุนููู
}
```

---

### 2. dropdown ูุงุฎุชูุงุฑ ุงููุฑุน ุนูุฏ ุฅูุดุงุก ุฅูุฌุงุฑ (ููุฃุฏูู ููุท) โ

**ุงููููุงุช ุงููุนุฏูุฉ:**

- `src/pages/Rentals.tsx`

**ุงููุฒุงูุง:**

- โ ูุธูุฑ dropdown ููุท ููุฃุฏูู
- โ ูุชู ุชุญููู ูุงุฆูุฉ ุงููุฑูุน ุชููุงุฆูุงู
- โ ุงููุณุชุฎุฏู ุงูุนุงุฏู ูุณุชุฎุฏู ูุฑุนู ุงููุฑุชุจุท ุจู ุชููุงุฆูุงู
- โ ุงูุชุญูู ูู ุงุฎุชูุงุฑ ุงููุฑุน ูุจู ุงูุญูุธ

**ุงูููุฏ:**

```tsx
{
  userRole?.role === "admin" && (
    <div className="space-y-2">
      <Label>ุงููุฑุน *</Label>
      <Select value={selectedBranch} onValueChange={setSelectedBranch}>
        <SelectTrigger>
          <SelectValue placeholder="ุงุฎุชุฑ ุงููุฑุน" />
        </SelectTrigger>
        <SelectContent>
          {branches?.map((branch: any) => (
            <SelectItem key={branch.id} value={branch.id}>
              {branch.name}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </div>
  );
}
```

---

### 3. ุนุฑุถ ุงุณู ุงููุฑุน ูู ุงูููุงุชูุฑ ูุงูุนููุฏ โ

**ุงููููุงุช ุงููุนุฏูุฉ:**

- `src/pages/RentalContract.tsx` - ุฅุถุงูุฉ ุนุฑุถ ุงุณู ุงููุฑุน ูู ุงูููุฏุฑ
- `src/pages/RentalInvoice.tsx` - ุฅุถุงูุฉ ุนุฑุถ ุงุณู ุงููุฑุน ูุน ุจูุงูุงุช ุงูุดุฑูุฉ

**ุงููุชูุฌุฉ:**

- โ ูุธูุฑ ุงุณู ุงููุฑุน ุจูุถูุญ ูู ุงูุนูุฏ
- โ ูุธูุฑ ุงุณู ุงููุฑุน ูู ุงููุงุชูุฑุฉ ุชุญุช ุงุณู ุงูุดุฑูุฉ

---

### 4. ุฅุถุงูุฉ ุญููู ูู ุฌุฏูู branches ูุฑุจุท ุงููุฑูุน ุจุญุณุงุจุงุช โ

**ุงูููู:**

- `supabase/migrations/20251029160000_add_customer_fields_and_branch_accounts.sql`

**ุงูุญููู ุงููุถุงูุฉ:**

```sql
ALTER TABLE public.branches
ADD COLUMN IF NOT EXISTS user_id UUID REFERENCES auth.users(id),
ADD COLUMN IF NOT EXISTS user_email TEXT,
ADD COLUMN IF NOT EXISTS user_password TEXT;
```

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู ุงููุทููุจุฉ:

### ุงูุฎุทูุฉ 1: ุชุทุจูู SQL Migration

ุงูุชุญ Supabase Dashboard โ SQL Editor ูุดุบูู:

```sql
-- ูุญุชูู ุงูููู:
-- supabase/migrations/20251029160000_add_customer_fields_and_branch_accounts.sql
```

### ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ

#### ุงุฎุชุจุงุฑ ุญููู ุงูุนููุงุก:

1. ุงูุชุญ ุตูุญุฉ "ุงูุนููุงุก"
2. ุฃุถู ุนููู ุฌุฏูุฏ
3. ุงููุฃ ุญููู "ูุตุฏุฑ ุงููููุฉ" ู "ุงูุนููุงู"
4. ุชุฃูุฏ ูู ุธููุฑูุง ูู ุจุทุงูุฉ ุงูุนููู

#### ุงุฎุชุจุงุฑ ุงุฎุชูุงุฑ ุงููุฑุน ูู ุงูุฅูุฌุงุฑุงุช:

1. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุฃุฏูู
2. ุงูุชุญ ุตูุญุฉ "ุงูุฅูุฌุงุฑุงุช"
3. ุงุถุบุท "ุฅูุฌุงุฑ ุฌุฏูุฏ"
4. ูุฌุจ ุฃู ูุธูุฑ dropdown "ุงููุฑุน" ูู ุงูุฃุนูู
5. ุงุฎุชุฑ ูุฑุน ูุฃููู ุงูุฅูุฌุงุฑ
6. ุชุฃูุฏ ูู ุฑุจุท ุงูุฅูุฌุงุฑ ุจุงููุฑุน ุงูุตุญูุญ

#### ุงุฎุชุจุงุฑ ุนุฑุถ ุงููุฑุน ูู ุงูุนูุฏ ูุงููุงุชูุฑุฉ:

1. ุงูุชุญ ุฃู ุฅูุฌุงุฑ ููุฌูุฏ
2. ุงุถุบุท "ุทุจุงุนุฉ ุงูุนูุฏ"
3. ุชุฃูุฏ ูู ุธููุฑ ุงุณู ุงููุฑุน ูู ุงูููุฏุฑ
4. ุงุฑุฌุน ูุงุถุบุท "ุทุจุงุนุฉ ูุงุชูุฑุฉ"
5. ุชุฃูุฏ ูู ุธููุฑ ุงุณู ุงููุฑุน ุชุญุช ุงุณู ุงูุดุฑูุฉ

---

## โ๏ธ ููุงุญุธุฉ ูููุฉ ุจุฎุตูุต ุฑุจุท ุงููุฑูุน ุจุญุณุงุจุงุช:

ุฅูุดุงุก ูุณุชุฎุฏููู ูู Supabase Auth ูุญุชุงุฌ ุฅูู:

- **Service Role Key** (ุฎุทูุฑ ููุง ูููุตุญ ุจุงุณุชุฎุฏุงูู ูู Frontend)
- **Supabase Edge Function** (ูุญุชุงุฌ deployment)
- **Admin API ูู Backend** (ูุญุชุงุฌ backend ูููุตู)

### ุงูุญู ุงูููุตู ุจู (ููุจุณุงุทุฉ ูุงูุฃูุงู):

1. **ุนูุฏ ุฅุถุงูุฉ ูุฑุน ุฌุฏูุฏ:**

   - ุงูุฃุฏูู ูุฏุฎู ุงุณู ุงููุฑุน
   - ุงููุธุงู ูููุฏ ุจุฑูุฏ ุฅููุชุฑููู ููุชุฑุญ: `{branch_name}@company.local`
   - ุงููุธุงู ูููุฏ ุจุงุณูุฑุฏ ุนุดูุงุฆู
   - ูุธูุฑ ูุงูุฐุฉ ููุจุซูุฉ ุจูุง ุงูุจุฑูุฏ ูุงูุจุงุณูุฑุฏ
   - ุฒุฑ "ูุณุฎ ุงูุจูุงูุงุช"
   - ุฑุณุงูุฉ: "ุงุญูุธ ูุฐู ุงูุจูุงูุงุชุ ูู ุชุธูุฑ ูุฑุฉ ุฃุฎุฑู"

2. **ุงูุฃุฏูู ูููู ูุฏููุงู:**

   - ููุชุญ Supabase Dashboard โ Authentication
   - ูุถูู ูุณุชุฎุฏู ุฌุฏูุฏ ุจุงูุจุฑูุฏ ูุงูุจุงุณูุฑุฏ
   - ูุฑุจุทู ุจุงููุฑุน ูู ุฌุฏูู `user_roles`

3. **ุฃู ุงุณุชุฎุฏุงู ุตูุญุฉ ุชุณุฌูู:**
   - ุฅูุดุงุก ุตูุญุฉ `/branch-signup`
   - ุงูุฃุฏูู ูุฑุณู ุงูุฑุงุจุท ูููุฑุน
   - ุงููุฑุน ูุณุฌู ุจููุณู

### ุฅุฐุง ุฃุฑุฏุช ุงูุญู ุงูุฃูุชููุงุชููู ุงููุงูู:

ุณุฃุญุชุงุฌ ุฅูุดุงุก **Supabase Edge Function** ูุฅูุดุงุก ุงููุณุชุฎุฏููู ุชููุงุฆูุงู.

---

## ๐ ุงูุญุงูุฉ ุงูููุงุฆูุฉ:

| ุงููุทููุจ               | ุงูุญุงูุฉ            | ุงูููู              |
| --------------------- | ----------------- | ------------------ |
| ุญูู ูุตุฏุฑ ุงููููุฉ       | โ ููุชูู          | Customers.tsx      |
| ุญูู ุงูุนููุงู           | โ ููุชูู          | Customers.tsx      |
| dropdown ุงููุฑุน ููุฃุฏูู | โ ููุชูู          | Rentals.tsx        |
| ุนุฑุถ ุงููุฑุน ูู ุงูุนูุฏ    | โ ููุชูู          | RentalContract.tsx |
| ุนุฑุถ ุงููุฑุน ูู ุงููุงุชูุฑุฉ | โ ููุชูู          | RentalInvoice.tsx  |
| SQL Migration         | โ ุฌุงูุฒ ููุชุทุจูู   | migrations/        |
| ุฅูุดุงุก ุญุณุงุจุงุช ุงููุฑูุน   | ๐ก ูุญุชุงุฌ ุญู ุฅุถุงูู | -                  |

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ:

ูู ุชุฑูุฏ:

1. โ ุชุทุจูู ุงูุชุบููุฑุงุช ููุง ูู (ููุตู ุจู)
2. ๐ฆ ุฅูุดุงุก Edge Function ูุฅูุดุงุก ุงููุณุชุฎุฏููู ุชููุงุฆูุงู
3. ๐ ุฅูุดุงุก ุตูุญุฉ ุชุณุฌูู ูููุฑูุน
4. ๐จ ุชุนุฏููุงุช ุฅุถุงููุฉ ุนูู ุงููุงุฌูุฉ

---

## ๐ธ ูุง ุชู ุชุบููุฑู ุจุงูุถุจุท:

### ูู ุตูุญุฉ ุงูุนููุงุก:

```diff
+ ุฅุถุงูุฉ ุญูู "ูุตุฏุฑ ุงููููุฉ"
+ ุฅุถุงูุฉ ุญูู "ุงูุนููุงู"
+ ุนุฑุถูู ูู ุจุทุงูุงุช ุงูุนููุงุก
```

### ูู ุตูุญุฉ ุงูุฅูุฌุงุฑุงุช:

```diff
+ dropdown ุงุฎุชูุงุฑ ุงููุฑุน (ููุฃุฏูู ููุท)
+ ุงูุชุญูู ูู ุงุฎุชูุงุฑ ุงููุฑุน ูุจู ุงูุญูุธ
+ ุฑุจุท ุงูุฅูุฌุงุฑ ุจุงููุฑุน ุงููุญุฏุฏ
```

### ูู ุงูุนููุฏ ูุงูููุงุชูุฑ:

```diff
+ ุนุฑุถ ุงุณู ุงููุฑุน ูู ููุฏุฑ ุงูุนูุฏ
+ ุนุฑุถ ุงุณู ุงููุฑุน ูู ุจูุงูุงุช ุงูุดุฑูุฉ ุจุงููุงุชูุฑุฉ
```

---

**๐ ุฌููุน ุงููุทุงูุจ ุงูุฃุณุงุณูุฉ ุชู ุฅูุฌุงุฒูุง ุจูุฌุงุญ!**
