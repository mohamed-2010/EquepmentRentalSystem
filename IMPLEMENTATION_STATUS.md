# ุญุงูุฉ ุงูุชูููุฐ - ููุฎุต ุงูุชุนุฏููุงุช

## โ ุชู ุฅูุฌุงุฒู:

### 1. ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ูู ุฌุฏูู ุงูุนููุงุก (Customers)

- โ ุฅุถุงูุฉ SQL Migration: `20251029160000_add_customer_fields_and_branch_accounts.sql`
- โ ุชุญุฏูุซ ูุงุฌูุฉ TypeScript: `CustomerData` ูู `db.ts`
- โ ุฅุถุงูุฉ ุญูู "ูุตุฏุฑ ุงููููุฉ" (id_source) ูู ุตูุญุฉ Customers
- โ ุฅุถุงูุฉ ุญูู "ุงูุนููุงู" (address) ูู ุตูุญุฉ Customers
- โ ุชุญุฏูุซ ูููุฐุฌ ุงูุฅุถุงูุฉ ูุงูุชุนุฏูู
- โ ุชุญุฏูุซ ุนุฑุถ ุจุทุงูุงุช ุงูุนููุงุก
- โ ุชุญุฏูุซ `CustomerAutocomplete` component

### 2. ุฅุถุงูุฉ dropdown ูุงุฎุชูุงุฑ ุงููุฑุน ุนูุฏ ุฅูุดุงุก ุฅูุฌุงุฑ

- โ ุฅุถุงูุฉ state `selectedBranch` ูู Rentals.tsx
- โ ุฅุถุงูุฉ query ูุชุญููู ูุงุฆูุฉ ุงููุฑูุน (ููุฃุฏูู ููุท)
- โ ุฅุถุงูุฉ Dropdown ูู ูุงุฌูุฉ ุฅูุดุงุก ุงูุฅูุฌุงุฑ
- โ ุชุญุฏูุซ ููุทู `handleCreateRental` ูุงุณุชุฎุฏุงู ุงููุฑุน ุงููุญุฏุฏ
- โ ุชุญุฏูุซ ุดุฑุท ุงูุชูุนูู ููุฒุฑ "ุชุฃููุฏ ูุทุจุงุนุฉ ุงูุนูุฏ"

## ๐ก ููุฏ ุงูุชูููุฐ - ูุญุชุงุฌ ุฅููุงู:

### 3. ุฑุจุท ูู ูุฑุน ุจุญุณุงุจ ูุณุชุฎุฏู ุชููุงุฆูุงู

**ูุง ุชู:**

- โ ุฅุถุงูุฉ ุญููู ูู ุฌุฏูู branches (SQL Migration):
  - `user_id` (UUID)
  - `user_email` (TEXT)
  - `user_password` (TEXT)

**ูุง ูุญุชุงุฌ ุฅููุงู:**

- โณ ุชุญุฏูุซ ุตูุญุฉ Branches ูุฅูุดุงุก ุญุณุงุจ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ูุฑุน
- โณ ุฅุถุงูุฉ ุนุฑุถ ุงูุจุฑูุฏ ูุงูุจุงุณูุฑุฏ ูู ูุฑูุช ุงููุฑูุน
- โณ ุฅุถุงูุฉ ุฎูุงุฑ ุฅุธูุงุฑ/ุฅุฎูุงุก ุงูุจุงุณูุฑุฏ (Eye icon)
- โณ ุฅุฎูุงุก ุตูุญุฉ ุงููุฑูุน ุนู ุงููุณุชุฎุฏููู ุบูุฑ ุงูุฃุฏูู (ุฌุฒุฆูุงู ุชู)

### 4. ุนุฑุถ ุงุณู ุงููุฑุน ูู ุงูููุงุชูุฑ ูุงูุนููุฏ

**ูุง ูุญุชุงุฌ:**

- โณ ุชุญุฏูุซ `RentalContract.tsx` ูุนุฑุถ ุงุณู ุงููุฑุน
- โณ ุชุญุฏูุซ `RentalInvoice.tsx` ูุนุฑุถ ุงุณู ุงููุฑุน
- โณ ุฌูุจ ุจูุงูุงุช ุงููุฑุน ูู `rentals.branches.name`

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงููุทููุจุฉ:

### ุงูุฎุทูุฉ 1: ุชุทุจูู SQL Migration ุนูู Supabase

```sql
-- ูุณุฎ ููุตู ูุญุชูู ุงูููู:
-- supabase/migrations/20251029160000_add_customer_fields_and_branch_accounts.sql
-- ูู SQL Editor ุนูู Supabase Dashboard
```

### ุงูุฎุทูุฉ 2: ุชุนุฏูู ุตูุญุฉ Branches

ูุญุชุงุฌ ุชุนุฏูู `src/pages/Branches.tsx` ูู:

1. ุฅุถุงูุฉ ุฏุงูุฉ ูุฅูุดุงุก ุญุณุงุจ ูุณุชุฎุฏู ุนูุฏ ุฅุถุงูุฉ ูุฑุน
2. ุชูููุฏ email ู password ุชููุงุฆูุงู
3. ุฅูุดุงุก ุงููุณุชุฎุฏู ูู Supabase Auth
4. ุญูุธ ุงูุจูุงูุงุช ูู ุฌุฏูู branches
5. ุนุฑุถ ุงูุจุฑูุฏ ูุงูุจุงุณูุฑุฏ ูู ูุฑูุช ุงููุฑูุน (ููุฃุฏูู ููุท)

### ุงูุฎุทูุฉ 3: ุชุนุฏูู RentalContract.tsx ู RentalInvoice.tsx

ุฅุถุงูุฉ ุนุฑุถ ุงุณู ุงููุฑุน ูู ุงูุนูุฏ ูุงููุงุชูุฑุฉ

## ๐ด ููุงุญุธุงุช ูููุฉ:

1. **ุฅูุดุงุก ูุณุชุฎุฏู ูู Supabase Auth ูุญุชุงุฌ:**
   - ุงุณุชุฎุฏุงู `service_role` key (ุฎุทูุฑ!)
   - ุฃู ุงุณุชุฎุฏุงู Supabase Edge Function
   - ุฃู ุงุณุชุฎุฏุงู Admin API ูู Backend
2. **ุจุฏูู ุฃุจุณุท ูุฃุฃูู:**

   - ุญูุธ ุงูุจุฑูุฏ ูุงูุจุงุณูุฑุฏ ูู ุฌุฏูู branches ููุท
   - ุฅูุดุงุก ุงูุญุณุงุจ ูุฏููุงู ูู ููุญุฉ Supabase
   - ุฃู ุฅูุดุงุก ุตูุญุฉ ุชุณุฌูู ูููุตูุฉ ูููุฑูุน

3. **ุงูุฃูุงู:**
   - ุชุฎุฒูู ุงูุจุงุณูุฑุฏ ุจุตูุบุฉ plain text ุบูุฑ ุขูู
   - ูููุถู ุงุณุชุฎุฏุงู hash ุฃู ุนุฏู ุชุฎุฒููู ููุงุฆูุงู
   - ุนุฑุถู ูุฑุฉ ูุงุญุฏุฉ ููุท ุนูุฏ ุงูุฅูุดุงุก

## ๐ฏ ุงูุชูุตูุงุช:

### ููุญู ุงูุจุณูุท (ููุตู ุจู):

1. ุนูุฏ ุฅุถุงูุฉ ูุฑุน ุฌุฏูุฏุ ุนุฑุถ ูุงูุฐุฉ ููุจุซูุฉ ุจูุง:

   - ุงูุจุฑูุฏ ุงูููุชุฑุญ: `branch_name@company.local`
   - ุงูุจุงุณูุฑุฏ ุงููููุฏ ุชููุงุฆูุงู
   - ุฒุฑ "ูุณุฎ ุงูุจูุงูุงุช"
   - ุฑุณุงูุฉ: "ุงุญูุธ ูุฐู ุงูุจูุงูุงุชุ ูู ุชุธูุฑ ูุฑุฉ ุฃุฎุฑู"

2. ุนุฏู ุชุฎุฒูู ุงูุจุงุณูุฑุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

3. ุงูุฃุฏูู ูููู ุจุฅูุดุงุก ุงูุญุณุงุจ ูุฏููุงู ูู Supabase Dashboard
   ุฃู ูู ุตูุญุฉ ุชุณุฌูู ูููุตูุฉ

### ููุญู ุงููุชูุฏู (ูุญุชุงุฌ Backend):

ุฅูุดุงุก Supabase Edge Function ุชููู ุจู:

- ุฅูุดุงุก ุงููุณุชุฎุฏู ูู Auth
- ุฅูุดุงุก ุงูุณุฌู ูู user_roles
- ุฑุจุทู ุจุงููุฑุน

---

## ๐ ูููุชุงุจุนุฉ:

ูู ุชุฑูุฏ:

1. โ ุฅููุงู ุงูุชุนุฏููุงุช ุจุงูุญู ุงูุจุณูุท (ููุตู ุจู)
2. โก ุฅูุดุงุก Edge Function ููุญู ุงููุชูุฏู
3. ๐ ุดุฑุญ ููุตู ููู ุฎุทูุฉ
